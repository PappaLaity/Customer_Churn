{
    "schemaVersion": 39,
    "title": "Churn API - Monitoring",
    "timezone": "browser",
    "panels": [
      {
        "type": "timeseries",
        "title": "Prediction p95 latency (s)",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(prediction_latency_seconds_bucket[5m])) by (le))",
            "legendFormat": "p95"
          }
        ]
      },
      {
        "type": "timeseries",
        "title": "Throughput (req/s)",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "targets": [
          {
            "expr": "sum(rate(prediction_requests_total[1m]))",
            "legendFormat": "rps"
          }
        ]
      },
      {
        "type": "timeseries",
        "title": "Error rate (%)",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8},
        "targets": [
          {
            "expr": "100 * (sum(rate(prediction_errors_total[5m])) / sum(rate(prediction_requests_total[5m])))",
            "legendFormat": "error%"
          }
        ]
      },
      {
        "type": "timeseries",
        "title": "Feature drift (KS D)",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8},
        "targets": [
          {
            "expr": "feature_drift_statistic",
            "legendFormat": "{{feature}}"
          }
        ]
      },
      {
        "type": "stat",
        "title": "Online accuracy",
        "gridPos": {"h": 6, "w": 6, "x": 0, "y": 16},
        "targets": [
          { "expr": "model_accuracy" }
        ]
      },
      {
        "type": "stat",
        "title": "Current p95 latency (s)",
        "gridPos": {"h": 6, "w": 6, "x": 6, "y": 16},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, sum(rate(prediction_latency_seconds_bucket[5m])) by (le))"
          }
        ]
      },
      {
        "type": "timeseries",
        "title": "Feature means",
        "gridPos": {"h": 6, "w": 12, "x": 12, "y": 16},
        "targets": [
          {
            "expr": "feature_mean",
            "legendFormat": "{{feature}}"
          }
        ]
      }
    ]
  }